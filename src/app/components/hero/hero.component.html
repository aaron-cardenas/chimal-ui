<section class="relative h-dvh w-full overflow-hidden">
  <!-- Desktop Accordion Slider -->
  <div class="hidden md:flex h-full w-full">
    @for (slide of slides; track slide.id; let i = $index) {
    <div (click)="setActive(i)" class="relative h-full cursor-pointer overflow-hidden transition-all duration-1000 ease-in-out"
      [ngClass]="{ 'flex-grow': activeIndex() === i, 'flex-grow-0 w-[120px] hover:w-[140px]': activeIndex() !== i }">
      <div class="absolute inset-0 bg-cover bg-center transition-transform duration-[20000ms] ease-linear" [class.animate-kenburns]="activeIndex() === i"
        [style.backgroundImage]="'url(' + slide.imageUrl + ')'"></div>
      <div class="absolute inset-0 transition-opacity duration-1000" [ngClass]="activeIndex() === i ? 'bg-black/40' : 'bg-black/70 hover:bg-black/50'">
      </div>

      <!-- Collapsed Content -->
      <div class="absolute inset-0 flex items-center justify-center transition-opacity duration-1000" [class.opacity-0]="activeIndex() === i"
        [class.opacity-100]="activeIndex() !== i">
        <h2 class="font-serif text-3xl text-white uppercase transform rotate-180 writing-mode-vertical-rl whitespace-nowrap [text-shadow:_0_2px_4px_rgba(0,0,0,0.5)]">
          {{ slide.collapsedTitle }}
        </h2>
      </div>

      <!-- Expanded Content -->
      <div class="relative w-[600px] max-w-full h-full p-12 lg:p-20 flex flex-col justify-end text-white transition-opacity duration-1000" [class.opacity-100]="activeIndex() === i"
        [class.opacity-0]="activeIndex() !== i" appReveal>
        <div class="transform transition-all duration-1000" [ngClass]="activeIndex() === i ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0'">
          <h1 class="font-serif text-5xl lg:text-5xl font-bold mb-4 [text-shadow:_0_2px_8px_rgba(0,0,0,0.7)]">{{ slide.title }}</h1>
          <p class="font-sans text-lg lg:text-xl max-w-md mb-2 [text-shadow:_0_1px_4px_rgba(0,0,0,0.7)]">{{ slide.subtitle }}</p>
          <p class="text-sm opacity-90 mb-6">Asesoría sin costo • Multiples opciones comparadas • Gestión integral del trámite</p>
          <a [href]="waLink(slide.segment)" (click)="onClickWa(slide.segment)" target="_blank" rel="noopener"
            class="font-sans btn-outline-gold px-8 py-3 rounded-full transition-colors duration-300 self-start">
            {{ slide.ctaText }}
          </a>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Mobile Horizontal Slider -->
  <div #mobileSlider class="md:hidden flex h-full w-full overflow-x-auto snap-x snap-mandatory pb-24 scrollbar-hide" (scroll)="onMobileScroll($event)">
    @for (slide of slides; track slide.id; let i = $index) {
    <div class="relative w-full h-full flex-shrink-0 snap-center overflow-hidden">
      <div class="absolute inset-0 bg-cover bg-center" [class.animate-kenburns]="mobileActiveIndex() === i" [style.background-image]="'url(' + slide.imageUrl + ')'"></div>
      <div class="absolute inset-0 bg-black/50"></div>
      <div class="relative h-full p-8 flex flex-col justify-end text-white">
        <h1 class="font-serif text-4xl font-bold mb-3 [text-shadow:_0_2px_8px_rgba(0,0,0,0.7)]">{{ slide.title }}</h1>
        <p class="font-sans text-base max-w-md mb-2 [text-shadow:_0_1px_4px_rgba(0,0,0,0.7)]">{{ slide.subtitle }}</p>
        <p class="text-xs opacity-90 mb-4">Asesoría sin costo • Multiples opciones comparadas • Gestión integral del trámite</p>
        <a [href]="waLink(slide.segment)" (click)="onClickWa(slide.segment)" target="_blank" rel="noopener"
          class="font-sans btn-outline-gold px-6 py-2 rounded-full transition-colors duration-300 self-start">
          {{ slide.ctaText }}
        </a>
      </div>
    </div>
    }
  </div>

  <div class="absolute bottom-16 left-1/2 -translate-x-1/2 md:hidden flex space-x-2 z-10">
    @for (slide of slides; track slide.id; let i = $index) {
    <button (click)="scrollToSlide(i)" class="w-2 h-2 rounded-full transition-all duration-300" [ngClass]="mobileActiveIndex() === i ? 'bg-white scale-125' : 'bg-white/50'"
      [attr.aria-label]="'Ir a diapositiva ' + (i + 1)">
    </button>
    }
  </div>
  <div class="absolute bottom-4 left-1/2 -translate-x-1/2 md:hidden">
    <a href="#main" class="btn-outline-gold px-4 py-2 rounded-full">Ver más</a>
  </div>
</section>